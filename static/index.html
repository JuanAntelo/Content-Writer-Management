<!-- Content Marketing -->
<script src="lib/js/jquery.min.js"></script>
<script src="lib/js/bootstrap.min.js"></script>
<script src="lib/js/highcharts.js"></script>
<script src="lib/js/exporting.js"></script>
<script src="lib/js/handlebars.min.js"></script>
<script src="lib/js/lodash.min.js"></script>
<script src="lib/js/moment.min.js"></script>
<script src="lib/js/superagent.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/css/bootstrap.min.css">

<body>
<div class="banner">
  <p id="header">Content Writer Manager</p>
  <div id="container">
  	<div id="chart"></div>
  	<div id="table">
  	      <div class="users-list">
  		<div class="col-md-12">
			<div class="row">
				<div class="col-sm-2"><label>Image</label></div>
				<div class="col-sm-2"><label>Name</label></div>
				<div class="col-sm-5 text-center"><label>Content by Type</label></div>
				<div class="col-sm-2"><label>Employee Type</label></div>
				<div class="col-sm-1"><label>Views</label></div>
			</div>
			<div id="templatePlaceholder"></div>
			<script id="entry-template" type="text/x-handlebars-template">
				{{#list writers}}
				<div class="row user">
					<div class="col-sm-2 avatar"><img src="{{imgPath}}"></div>
					<div class="col-sm-2"><a href="#">{{name}}</a></div>
					<div class="col-sm-5">
						<div class="col-sm-4">Social Media Post: {{socialMediaPostCount}}</div>
						<div class="col-sm-4">Blog Post: {{blogPostCount}}</div>
						<div class="col-sm-4">Other: {{otherPostCount}}</div>
					</div>
					<div class="col-sm-2"><div>{{employeeType}}</div></div>
					<div class="col-sm-1"><div>{{totalViews}}</div></div>
				</div>
				{{/list}}
			</script>
		</div>
	      </div>
  	</div>
  </div>
</div>
</body>
<script>
	superagent.get('/writerTotalViewList').end(function(err, res){
   		console.log(res);
   	});

   	superagent.get('/writerMetaDataList').end(function(err, res){
   		console.log(res);
   	});

</script>
<script>
//  Populate Index table
Handlebars.registerHelper('list',function(items, options){
	var ret = "";
	for(var i = 0; i<items.length; i++) {
		ret = ret + options.fn(items[i])
	}
	return ret;
});	
var source   = $("#entry-template").html();
var template = Handlebars.compile(source);
var context =  getWriterMetaData();
$("#templatePlaceholder").html(template(context));

// API Call
function getWriterMetaData()	{	
		return	{ writers : [{
				name: 'Steve J',
				imgPath: 'lib/images/7.jpg',
				socialMediaPostCount : 3,
				blogPostCount : 2,
				otherPostCount : 1,
				employeeType : "Fulltime",
				totalViews : 49
	           		  },
	           		  {
				name: 'Bill A',
				imgPath: 'lib/images/2.jpg',
				socialMediaPostCount : 5,
				blogPostCount : 1,
				otherPostCount : 1,
				employeeType : "Fulltime",
				totalViews : 71
	           		  },
		              {
				name: 'Joe K',
				imgPath: 'lib/images/5.jpg',
				socialMediaPostCount : 4,
				blogPostCount : 1,
				otherPostCount : 1,
				employeeType : "Fulltime",
				totalViews : 106
	           		  },
	           		  {
				name: 'Alex M',
				imgPath: 'lib/images/3.jpg',
				socialMediaPostCount : 2,
				blogPostCount : 3,
				otherPostCount : 1,
				employeeType : "Freelance",
				totalViews : 129
	           		  },
			  {
				name: 'Jade',
				imgPath: 'lib/images/6.jpg',
				socialMediaPostCount : 5,
				blogPostCount : 2,
				otherPostCount : 1,
				employeeType : "Temp",
				totalViews : 144
	           		  },
	           		  {
	           		  	name: 'Carlos A',
				imgPath: 'lib/images/1.jpg',
				socialMediaPostCount : 1,
				blogPostCount : 1,
				otherPostCount : 1,
				employeeType : "Fulltime",
				totalViews : 176

	           		  }]
	           	};
}	
</script> 

<script>
// Populate Index Graph
	var writerTotalViewList = getWriterTotalViewList(); 
	var xAxis =  _.map(writerTotalViewList, function(item) {
		return item.name;
	});
	var yAxis = _.map(writerTotalViewList, function(item) {
		return item.viewCount;
	});

	// API Call 
	function getWriterTotalViewList() {
		return [
			{id: 1, name: 'Steve J', viewCount: 49},
			{id: 2, name: 'Bill A', viewCount: 71},
			{id: 3, name: 'Joe K', viewCount: 106},
			{id: 4, name: 'Alex M', viewCount: 129},
			{id: 5, name: 'Jade S', viewCount: 144},
			{id: 6, name: 'Carlos A', viewCount: 176}
		];
	}
</script>
<script>
// Setup Index Chart
$(function () {
    $('#chart').highcharts({
        chart: { type: 'column' },
        title: { text: 'Total Views per Writer' },
        subtitle: { text: '' },
        yAxis: { min: 0, title: { text: 'Views' } },
        plotOptions: { column: { pointPadding: 0.2, borderWidth: 0 } },
        xAxis: { 
        	categories: xAxis
        },
        series: [{
            name: 'Content Views',
            data: yAxis
        }]	
    });
    // Remove excessive graph info
   $("svg > text")[1].innerHTML = "January 2010 - " + moment(Date.now()).format("MMMM YYYY");
   $(".highcharts-legend-item").remove(); 

});
</script>
<script>
	// idea for mochoa test -thier values MUST add up to the total graph
	// api testing. no properties must be null 
	// each view should correspond to the correct writer b/c lodash makes me question this
</script>
<style>	
	#header { font-size: 25px; }
	#container { min-width: 310px; height: 400px; margin: 0 auto; }
	.text-center { text-align: center; }
	.banner { background-color: rgba(239,238,238,0,64);	 }
	.user { padding: 5px; }
	.user > div:not(.avatar) { margin-top: 10px; }	
	@media (min-width: 800px) {
		.banner {
			margin-top:   5%;
			margin-left:   15%;
			margin-right: 15%;
		}
	}
	img {
	    	border-radius: 50%;
    		max-width: 45px;
	}
	.banner > p {
		padding-top:20px;
		text-align: center;
	}
	.users-list .user:nth-child(2n) {
    		background: #FAFAFC;
	}
</style>